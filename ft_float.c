/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_float.c                                         :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: bjasper <bjasper@student.42.fr>            +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/11/24 19:00:25 by bjasper           #+#    #+#             */
/*   Updated: 2019/12/25 16:42:18 by bjasper          ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "printf.h"
#include <float.h>

void	ft_bzero(void *s, size_t n)
{
	unsigned char *str;

	str = (unsigned char *)s;
	while (n)
	{
		*str = '\0';
		str++;
		n--;
	}
}

void    ft_power_to_massive(t_power_of_2 *powers, int power)
{
    if (power >= 0)
    {
        powers->integer[powers->size_int] = power;
        powers->size_int++;
    }
    else
    {
        powers->fract[powers->size_fract] = power;
        powers->size_fract++;
    }
}

char    *ft_float(long double a, t_struct *flags)
{
    t_print             divis;
    unsigned long long  mask; 
    int                 i;
    t_power_of_2        powers;
	t_float number;
    
    divis.number = a;
    divis.t_byte.exp -= 16383;
    i = 0;
    mask = 1L << 63;                           
    ft_bzero(&powers, sizeof(t_power_of_2));
    while (mask != 0)                                   
    {
        if ((divis.t_byte.mant & mask) != 0)         
            ft_power_to_massive(&powers, divis.t_byte.exp - i);                    
        ++i;
        mask >>= 1;
    }
    // print_struct_powers(&powers);
    number = ft_long_ariphm(powers);
	// print_float_number(&number, 15, MAX_FRACT_SIZE);
	return (float_tostr(&number, flags));
}

int main()
{
   long double a;
	t_struct flags;
	   
   a = 1.47893087987L;
//    a = LDBL_MIN;
   flags.precision = 10;
// a = 0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003362103143112093506262677817321752602598079344846471240108827229808742699390728967043092706365056222862501906668823473227090111471727678140747494195190631729166726391484998586218894493068740932312583186699859827484977154471718472731360102097109969846313544087646920079723924148002689793031875014798262534210292148078473467018391084487734307421803513073538672735931958686418311959441595234202164348118472491844597434279805771743287540154538703920841419920701695124560415024569275649406699538900247595247695317321765067573103181597138531216934946440714750725182818343250953021656567211954373202121429118506595945796555352311604444874792768392761485657965232216288790568158788525230289843003839164543067501319028825538561964321713076214022903129343482836736176490079427100375244180813040092261062525949870924735135820636585054733112374523955186567290645419506641365199683101680142687288568978456921205081052337615660310204777901450849407460913217202483761020953437447153656595362436183663394608242491106138007936702952778061013254187212440667774389783755803643706365110235541920014964055936317008160982112334400189311586042445449021858920909312031458785755128247723416172679973144751244562241433024432859336911914912321465945402019819523412733882931977051526643944555655133302515354621994896212630196487369422339458567624858134743395948945553201187683023172924999395654043357602989174799539683828730885077297612105022593337485827358263516187570266826843264742240090343902545176908151883664722693935768450351871818305448467673781259529903499163794241909944843138573586739368344828917571747677471529502448284418703026550942908376837671679083090288991714985198105668838862953817535081307392485024176198297106907993409312624858931103395860580700633537606824506231109296558670247441899304029060915482947415451046082496830296164598794199010259172385318059635342911531175176750541825296660617261190908563227918238262203718203815591715153655706432393006552780212425931598868823800838994147700556103243668157532077165800201448338796724056912086019621767022157316692546964139026311226211000027492605212462700980980242177030389734720351730651125799398322035309000329057761433918445399685674978931641954415561117461706843319953403431286203923848515480885429431448075077219067753526870349540110830321845744960087227923732927565593308898829201610043188582422959222684334086741149108152921885724853652727259980182503502548454316513637042713565615323293748636063731684372126294343996528780824867890518209142817854449591731906081321062782993695196160760170233481620289508327097719298590617105386738353627114950780146686834508424237366048384643562704281838897352768675544177805228048290007941676870366685340422104216877730141613770899283208770540407422789207952017664300516891757193028911734195342358174491566162092027286566997657425709594631799776592799276503815605221432313978551609725985127745836342430730704370033453736506046184054785151818814511506003446404737891197915357392015663495955719396405630089074548777885797096703056628857886557192731590593164923097136675210772255629409534984486205827095881852395009721403238149006617901912861893209476346089582740146597917635464370356805127626871666171807456852523733978910082750774720037752659936382432766788384909274210255390027775284192435156740949021930094609005335309659156257113720999685294681596907899597059492997689472366952148913255758120099727804904612100705458570099916010423675962321076240444577270118023947164461379165829426790115493061621854709818303115459103615806370549188984037421849993786246021979903637601660974321716499624238133717398244710503918479899767480069200108228249063603280607087417029493089375636827784090379116081127229460597625002813462540535071488357312195767966123047391640354569622565584188633622273276570742584822700414206943856517868311470198481157547955715609691974967695555232198775338538636313564166740100596890106091499936630711638122519421561598229526803034610502635775887383529394263763455946995819500365689870405652441068534579382118549314999817445930704024694879021268975338942192527154023942672041330548526429291229979781659865916793694569805553963381911018933702776030454189058993771243254936587148282329498279927185354715321193565320893474332913874870381479226557825266534681528098905406612257140237479900519921067398024233187387684371130387007587282975595603295689679737461989219641760789264565547696836454614499387250864698898719296769935276710904277724845005363481385838570687309285168004932279610782271008764280136863657879291287461382400481216009437033097371631188617578280214493832164937528828143415015697365456840050816829438276428624229751172427841065714863419442902710206363178313394926608013411263882483340734198293991928973392243995125694918141416948137339221197370926559186107301529336050136882081931981659262888595329115840098074011293505980430898541950516120964937479168459426084692988396598370131288429559828179403850699370829034239762454485047377874842508157189027068917293280262800068225298397207814100822668780393208759445\
6694360766836747120357523988019990026580421852454909392984242781693852184565854957363667372369195647707418194325420630075129133928535344887744717061472997859099521330486820561548473361616128221557559608820668534041826092566286300678554483072044113387601302344977544511549909450020270840108560916018969048199801049727015679399321112363226010696804239853019977629024632850566927266305157558974599209373691967846759032705913613727678645402903812668496946712192495209895117278019890656805518649784573998153642901553646491826572501719876381266645056144961508224442641743500704899714103798702625997249541914410568736623372965211580644698338408602804846783310626742392853900194863599419650447175791564001237942813875266868702430391965388693596963687059804387083320352110166915919924876724915616744282013801877455816464257023185942055109938289332295328140771466275521702279398956768893085707311411382305121347903470235006266953301781490333638363860150676119633970908198496243568881917283839449703316444581247562052139720916211015165629106830807139702202622042424098224662909540036600063506332675792493698734806294546049624282286500581144775404435180885701322086094170796604331223775727874229768210805165136951586007683974519913702454447297105597577079009193316452540220696513318099545080192750987197019468506097256962885018823953256867648982938120168548825173266603483825406111849847183994675328745526683158950219253693231117393584743306929631258973902090678269834180874144142148067562577765792982425521267148319613750198163262914968339906612582655281602494613067885566898223401654167396393082352052570222941741137123302528634451674972610491983203819647557686274985773076458102183961653968710236557178768045672808021242785302650267490870400641809455495238456488059149161028806792775306655222505308057797431875351611096506724046036277567128792952552053021568361701663808091836161396545334721760321186066910849413030835901138069095698149877048016843334763927390211473397502078125803157439422187629476773826739733098440529305842259052532623746800518064225771952591775857374539978641703070726572613303687406189980321039332499389223116881344721840238943584801398944396613713830251005454339327364217734169583114617969345357347620722945279314805392529171308104067682147693425486964992383385517902523250679907676784264787898082052810086892550452968993358363494258194480587884260801531925398287960253426912717660738023953009275543383365917379836421749788570425076930637591436528215467577773333739699511708183725691943880516846488305814985026852813679611615053755441532136513490625965925117961210156835124408644052153703499307205683864287019413498809036910467231873540413360389984853135017622892253276903249074410336562443967712673375748296981045862019397621244096451938651574712756263781806707181150399010907858634520149790127520609177431625331314521160571892720122662945864971548865489098747343545555207961604483896579595613007973073691350864102431230735806348202744391929640213514906462625373207079219259589327368783816400460747854161420043293241175778585920047019656533787829172005967985014865570261753421374255505845075060237227295313345470111709087614300132003486927689448436289857318590191267468946410695293053789347366653201236783863507591594684044930377991500290520654043141493792685904913078251576428544682776887020568596143398488107710806552701460697091365341091926056375248307040211374913925551945338312056640598237823924378098542192155647641780086976012592628186728850540050735837823827291587596007381396930971731695181639423202704472304227721426354289640452291987572373133398705603515162822874435854860696666220859580663845150268541348063094232019895154468843552230764280755462626895805082634605713734245299163110923321120423533792717254305999019550744155136388971639764992261098999612957001529210796214978861179370904761497237177959426772365441811188464977793139656854488309493466792385506706367487824092464235121821352062581796711831534240869020462051089194376149471856860252728093066614092681538581785022123388107041665451252951129840128659027527319598435340189972185873428762477296711231536006719920708512531287414118039206456403487704596160497123243868549751440126914324024596449520810427185769193814815557839343048980895034010385523790761666908586328092637132734484832333876057325845345291927345037673847302414921972181710310815860470008261518986697144736396638259523243253274773281225961015703892612668314611884902185938400468027559945281973949911586330305416503546771640142337823246432654336769848713462296690356358980341790529662374494670725647735073539680483889036270186583131092648816901754640559938973592417321653093811404867910830533745179590200827299217077414983729836694677243542887374992253903453242682578389933641745203994467466746781854451651375573523099450775187649046525528316663889407986122805626376768549440005356641573657311703178141972951914813700095541596488516554602889210209559325116482149274730422346257092919694079471802208547211443257035066157884578914319144179959952207019028548998232243676336967753117192213212903966575328079521385145904557188751208286365157012519874430758911985241984434596021119723096171338672342017819462609637748634113762945440155972489666268487560685328799795996212832159726195845448439353526585047229096333830269102915840123966374638717755633764139393952655033513354383279150418282371524276645361206188460779486639957883803864360217837876265174310927119932825713036046299079033196728201289219438568870396377362366125522107233459011137001674419684520483460088346648436911142590515474924783155695900070268259803685968845339090609204805992552225847799546885381457333848011241786039217749921908767557162673222580922678928085312960080630177628807695543955324555093993657432057792441664581022250698554369039321372462903735476853176116163262982964091359850452630935710399494974804433736578506807984703889139245017287878204838651028417934134765173844101408186912739898523074795356839427006487951447113483536344464378430707114154413838525043657991134313459908415148690527128082306909459267068745812866123751472758384980280649224662257930787520217416065251347215828404887042965797560009575730232316913979120702884449007787726741389445284073659657748558802676673755184469509117978810090927009838888848249243472182532852086153364329524084037103349259965330730389791953442916415173916493754879715087164695366900759173965758946446565468864589979419559841958969892417030678188893944025039672851562L;
   printf("result %s\n", ft_float(a, &flags)); 
   printf("result2 %.10Lf\n", a);
   return (0);
}
